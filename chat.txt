#!/usr/bin/env node

import { spawn } from "node:child_process";
import path from "node:path";

const args = process.argv;
const dir = import.meta.dirname;

const script = process.platform === "win32" ? "tsx.CMD" : "tsx";

const tsxPath = path.resolve(dir, `./node_modules/.bin/${script}`);
const cliPath = path.resolve(dir, "./src/cli.ts");

const child = spawn(tsxPath, [cliPath, ...args.slice(2)], {
  stdio: "inherit",
});

child.on("exit", (code) => process.exit(code));
child.on("error", console.error);

PS C:\Users\cimoe\Documents\projects\components> lpm
node:internal/child_process:420
    throw new ErrnoException(err, 'spawn');
          ^

Error: spawn EINVAL
    at ChildProcess.spawn (node:internal/child_process:420:11)
    at spawn (node:child_process:796:9)
    at file:///C:/Users/cimoe/Documents/projects/components/index.js:14:15
    at ModuleJob.run (node:internal/modules/esm/module_job:413:25)
    at async onImport.tracePromise.__proto__ (node:internal/modules/esm/loader:654:26)
    at async asyncRunEntryPointWithESMLoader (node:internal/modules/run_main:101:5) {
  errno: -4071,
  code: 'EINVAL',
  syscall: 'spawn'
}

Node.js v25.2.1
